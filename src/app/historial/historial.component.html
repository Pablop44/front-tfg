<div class="grid-container">
    <mat-grid-list cols="2" rowHeight="450px">
      <mat-grid-tile *ngFor="let card of cards | async" [colspan]="card.cols" [rowspan]="card.rows"> 
  
            <mat-card class="dashboard-card">
              <mat-card-header>
                <mat-card-title>
                  Historiales Clínicos
                </mat-card-title>
              </mat-card-header>
  
              <mat-card-content>

                <mat-card class="cartaFiltro">
                    <mat-card-header>
                      <mat-card-subtitle>
                        Filtrar Medicamentos
                      </mat-card-subtitle>
                    </mat-card-header>
  
                    <mat-card-content>

                      <form class="formFiltrar" (ngSubmit)="aplicarFiltro()" #loginForm="ngForm">
                        <mat-list>
                          <h3 mat-subheader>
                                Datos del Fichero
                          </h3>
                          <mat-list-item >
                            <mat-form-field style="width: 20%;">
                              <mat-label>Número de Historial</mat-label>
                              <input matInput type="number" id="id" name="id" [(ngModel)]="filtroHistorial.id" placeholder="Número">
                            </mat-form-field>
                            <mat-form-field style="width: 15%; margin-left: 80px;">
                              <mat-label>Fecha Inicio Periodo</mat-label>
                              <input matInput [matDatepicker]="dpInicio"  name="fechaInicio" id="fechaInicio" [(ngModel)]="filtroHistorial.fechaInicio">
                              <mat-datepicker-toggle matSuffix [for]="dpInicio"></mat-datepicker-toggle>
                              <mat-datepicker #dpInicio></mat-datepicker>
                            </mat-form-field>
                            <mat-form-field style="width: 15%; margin-left: 20px;">
                              <mat-label>Fecha Fin Periodo</mat-label>
                              <input matInput [matDatepicker]="dpFin"  name="fechaFin" id="fechaFin" [(ngModel)]="filtroHistorial.fechaFin">
                              <mat-datepicker-toggle matSuffix [for]="dpFin"></mat-datepicker-toggle>
                              <mat-datepicker #dpFin></mat-datepicker>
                            </mat-form-field>
                          </mat-list-item>
                          <mat-divider></mat-divider>
                          <h3 mat-subheader>
                                Datos del Paciente
                          </h3>
                          <mat-list-item >
                            <mat-form-field style="width: 25%; margin-right: 20px;">
                              <mat-label>DNI del paciente</mat-label>
                              <input matInput type="text" id="dniPaciente" name="dniPaciente" [(ngModel)]="filtroHistorial.dniPaciente" placeholder="Número">
                            </mat-form-field>
                            <mat-form-field style="width: 25%; margin-right: 20px;">
                              <mat-label>Nombre del Paciente</mat-label>
                              <input matInput type="text" id="nombrePaciente" name="nombrePaciente" [(ngModel)]="filtroHistorial.nombrePaciente" placeholder="Número">
                            </mat-form-field>
                            <mat-form-field style="width: 40%;">
                              <mat-label>Apellidos del Paciente</mat-label>
                              <input matInput type="text" id="apellidosPaciente" name="apellidosPaciente" [(ngModel)]="filtroHistorial.apellidosPaciente" placeholder="Número">
                            </mat-form-field>
                          </mat-list-item>
                          <div *ngIf="loginService.loggedUser.rol == 'administrador'">
                            <mat-divider></mat-divider>
                            <h3 mat-subheader>
                              Datos del Médico
                            </h3>
                            <mat-list-item >
                              <mat-form-field style="width: 20%; margin-right: 20px;">
                                <mat-label>DNI del Médico</mat-label>
                                <input matInput type="text" id="dniMedico" name="dniMedico"  [(ngModel)]="filtroHistorial.dniMedico" placeholder="Número">
                              </mat-form-field>
                              <mat-form-field style="width: 20%; margin-right: 20px;">
                                <mat-label>Nombre del Médico</mat-label>
                                <input matInput type="text" id="nombreMedico" name="nombreMedico" [(ngModel)]="filtroHistorial.nombreMedico" placeholder="Número">
                              </mat-form-field>
                              <mat-form-field style="width: 30%; margin-right: 20px;">
                                <mat-label>Apellidos del Médico</mat-label>
                                <input matInput type="text" id="apellidosMedico" name="apellidosMedico" [(ngModel)]="filtroHistorial.apellidosMedico" placeholder="Número">
                              </mat-form-field>
                              <mat-form-field style="width: 20%;">
                                <mat-label>Número de Colegiado</mat-label>
                                <input matInput type="number" id="colegiado" name="colegiado" [(ngModel)]="filtroHistorial.colegiado" placeholder="Número">
                              </mat-form-field>
                            </mat-list-item>
                          </div>
                          <mat-list-item>
                            <button mat-raised-button type="submit" color="primary">Filtrar</button>
                          </mat-list-item>

                        </mat-list>
                      </form>
  
                    </mat-card-content>
  
                  </mat-card>

                <div>
                    
                    <table  mat-table matSort [dataSource]="dataSource" >
                  
                      <!-- Progress Column -->
                      <ng-container matColumnDef="numero">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="ordenar('nombre')"> Número de Historial </th>
                        <td mat-cell *matCellDef="let row"> {{row.id}} </td>
                      </ng-container>

                      <ng-container matColumnDef="fecha">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="ordenar('viaAdministracion')"> Fecha de Creación </th>
                        <td mat-cell *matCellDef="let row"> {{row.fechaCreacion}} </td>
                      </ng-container>

                      <ng-container matColumnDef="enfermedad">
                        <th mat-header-cell *matHeaderCellDef> Enfermedad</th>
                        <td mat-cell *matCellDef="let row"> {{row.enfermedad}}</td>
                      </ng-container>
                  
                      <!-- Name Column -->
                      <ng-container matColumnDef="dniPaciente">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="ordenar('marca')"> DNI del Paciente</th>
                        <td mat-cell *matCellDef="let row"> {{row.pacienteDni}}</td>
                      </ng-container>

                      <ng-container matColumnDef="nombrePaciente">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="ordenar('dosis')"> Nombre del Paciente </th>
                        <td mat-cell *matCellDef="let row"> {{row.nombrePaciente}}</td>
                      </ng-container>

                      <ng-container matColumnDef="dniMedico">
                        <th mat-header-cell *matHeaderCellDef> DNI del Médico</th>
                        <td mat-cell *matCellDef="let row"> {{row.dniMedico}}</td>
                      </ng-container>

                      <ng-container matColumnDef="nombreMedico">
                        <th mat-header-cell *matHeaderCellDef> Nombre del Médico</th>
                        <td mat-cell *matCellDef="let row"> {{row.nombreMedico}}</td>
                      </ng-container>
                  
                      <ng-container matColumnDef="colegiado">
                        <th mat-header-cell *matHeaderCellDef> Número de Colegiado</th>
                        <td mat-cell *matCellDef="let row"> {{row.colegiado}}</td>
                      </ng-container>

                      <ng-container matColumnDef="acciones">
                        <th mat-header-cell *matHeaderCellDef> Acciones</th>
                        <td mat-cell *matCellDef="let row"> 
                          <a [routerLink]="['/ficha-individual', row.id]" mat-stroked-button color="primary" ><i class="material-icons"> remove_red_eye </i></a>
                          <button mat-stroked-button color="primary" *ngIf="loginService.loggedUser.rol == 'administrador'" (click)="openDialog(row)"><i class="material-icons"> remove_circle </i></button>
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                      </tr>
                    </table>
                  
                    <mat-paginator #paginator3 [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 15]" [showFirstLastButtons]="true" [length]="totalSize"
                        [pageIndex]="currentPage" (page)="pageEvent = handlePage($event)">
                    </mat-paginator>
                  </div>
                   
              </mat-card-content>
            </mat-card>
        
      </mat-grid-tile>
    </mat-grid-list>
  </div>
  
